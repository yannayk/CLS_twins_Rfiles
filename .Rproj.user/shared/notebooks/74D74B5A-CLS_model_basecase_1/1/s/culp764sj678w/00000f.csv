"0","## QALYs ##"
"0",""
"0","## Function to calculate total QALYs for a given gestational age category"
"0",""
"0","markov_qaly <- function(m_M.,"
"0","                        v_q.,"
"0","                        n_cycles. = n_cycles,"
"0","                        cycle_length. = cycle_length,"
"0","                        n_states. = n_states,"
"0","                        v_names_states. = v_names_states,"
"0","                        d_u. = d_u,"
"0","                        u_D. = u_D) {"
"0","  "
"0","  # Initiate an empty matrix for utilities"
"0","  m_ann_qaly <- matrix(NA,"
"0","                       nrow = (n_cycles. + 1), ncol = n_states.,"
"0","                       dimnames = list(0: n_cycles., v_names_states.))"
"0","  "
"0","  # Populate the matrix with state utility"
"0","  m_ann_qaly[, 1] <- v_q."
"0","  m_ann_qaly[, 2] <- u_D."
"0","  "
"0","  ## Annual discount weights for costs"
"0","  v_dwu <- 1 / (( 1 + (d_u. * cycle_length.)) ^ (0 : n_cycles.))"
"0","  "
"0","  # Initiate an empty matrix for costs"
"0","  m_q_GA <- matrix(NA,"
"0","                   nrow = (n_cycles. + 1), ncol = 1,"
"0","                   dimnames = list(0: n_cycles., ""Cost""))"
"0","  "
"0","  # Populate the single column matrix (state * state_utility)"
"0","  for (t in 0: n_cycles. + 1){"
"0","    m_q_GA[t, ] <- m_M.[t, ] %*% m_ann_qaly[t, ]"
"0","  }"
"0","  "
"0","  # Discount and sum the QALYs to give the GA category total"
"0","  q_GA <- sum(m_q_GA * v_dwu)"
"0","  "
"0","  return(list(annual = m_ann_qaly,  # Annual utilities by state for GA category"
"0","              total = q_GA,         # Total QALYs for GA category"
"0","              disc = v_dwu))        # Annual discount rate (not GA specific)"
"0","}"
"0",""
"0","# Calculation of total QALYs in markov chain by GA"
"0","q_M_28   <- markov_qaly(m_M. = m_M_28, v_q. = v_q_28)$total"
"0","q_M_32   <- markov_qaly(m_M. = m_M_32, v_q. = v_q_32)$total"
"0","q_M_34   <- markov_qaly(m_M. = m_M_34, v_q. = v_q_34)$total"
"0","q_M_37   <- markov_qaly(m_M. = m_M_37, v_q. = v_q_37)$total"
"0","q_M_term <- markov_qaly(m_M. = m_M_term, v_q. = v_q_term)$total"
"0",""
"0","# Vector of QALYs by GA"
"0","v_q_M_GA <- c(q_M_28, q_M_32, q_M_34, q_M_37, q_M_term)"
"0",""
"0","## STRATEGY TOTALS - QALYs ##"
"0",""
"0","# Product of QALYs by GA * GA distribution for a strategy"
"0","q_s1 <- sum(v_q_M_GA * s1_GA) * twin_factor"
"0","q_s2 <- sum(v_q_M_GA * s2_GA) * twin_factor"
"0","q_s3 <- sum(v_q_M_GA * s3_GA) * twin_factor"
"0",""
"0","# Vector of strategy QALYs"
"0","v_M_qaly <- c(s1 = q_s1, s2 = q_s2, s3 = q_s3)"
